<!DOCTYPE html>
<html>
<head>
  <title>PlayTime</title>
<meta charset="UTF-8">
<meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="//cdn.rawgit.com/innks/NanumSquareRound/master/nanumsquareround.min.css">
<link rel="stylesheet" href="//cdn.rawgit.com/hiun/NanumSquare/master/nanumsquare.css">
<link rel='stylesheet' href='//cdn.jsdelivr.net/foundation/5.5.0/css/foundation.css'>
<link rel="stylesheet" type="text/css" href="/css/style.css?date=<?=time()?>">
<style>
.bottom {
  /* -webkit-box-shadow: 0 0 5px 1px #cacaca;
  -moz-box-shadow: 0 0 5px 1px #cacaca;
  box-shadow: 0 0 5px 1px #cacaca; */
  padding-top:50px;
}
.content {
  margin: 30px 8% 0 8%;
  color: #333;
  text-align: left;
}
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 22px; 
}
/*스위치바탕 ie에서 테두리생김방지*/
.switch input {display:none;}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition:.4s;
}
/*스위치버튼 안쪽에 동그란모양*/
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 4px;
  bottom: 1px;
  background: white;
  transition: .4s;
}

/*체크된(on된)스위치바탕*/
input:checked + .slider {
  background: #FFCA02;
}
/*스위치버튼을 클릭하면 버튼주위에 글로우효과*/
input:focus + .slider {
  box-shadow: 0 0 3px #FFCA02;
}
/*스위치버튼을 클릭하면 우측으로 26px이동*/
input:checked + .slider:before {
  transform: translateX(22px);
}

/*Rounded sliders*/
.slider.round {
  border-radius: 34px;
}
/*스위치버튼 안쪽에 동그란모양*/
.slider.round:before {
  border-radius: 50%;
}
a, a:visited, a:hover, a:focus {
  color: #000;
}
</style>
</head>
<body>
  <form id="membership_frm">
    <input id="USER_ID" name="USER_ID" type="hidden" value="MOBILE">
    <input id="CUST_ID" name="CUST_ID" type="hidden">
    <input id="EMAIL_RCV_YN" name="EMAIL_RCV_YN" type="hidden">
    <input id="SMS_RCV_YN" name="SMS_RCV_YN" type="hidden">
    <input id="PUSH_RCV_YN" name="PUSH_RCV_YN" type="hidden">
	<!-- 디바이스 정보 -->
    <input id="DEVICE_DIV" name="DEVICE_DIV" type="hidden">
    <input id="DEVICE_NM" name="DEVICE_NM" type="hidden">
    <input id="MOBILE_KIND" name="MOBILE_KIND" type="hidden">
    <input id="AUTH_TOKEN" name="AUTH_TOKEN" type="hidden" value="">
  </form>

  <div class="bottom">
    <div style="margin:0 5.5% 0 5.5%; height:40px; text-align:center;">
      <div style="float:left; width:15%; text-align:left; font-size:20px; color:#000;"><i id="back" class="fas fa-chevron-left"></i></div>
      <div class="nsR" style="float:left; width:70%; text-align:center; font-size:20px;">환경 설정</div>
      <div style="float:left; width:15%; text-align:right; font-size:20px;"></div>
    </div>
  </div>

  <div class="content">
    <div class="nsB" style="font-size:18px; color:#000;">계정 정보</div>
    <div class="nsR" style="font-size:15px; padding-top:15px;"><span id="find"></span></div>
    <div class="nsR" style="font-size:15px; padding-top:15px;">
      <a href="/change_pw.html">비밀번호 변경</a>
    </div>
    <div class="nsR" style="font-size:15px; padding-top:15px;">
      <span id="logout">로그아웃</span>
    </div>
    <div class="nsR" id="withdrawal" style="font-size:15px; padding-top:15px;">
      <a href="/member_delete.html">회원탈퇴</a>
    </div>
  </div>

  <div class="content">
    <div class="nsB" style="font-size:18px; color:#000;">알림 설정</div>

    <div style="width:100%; padding-top:15px; display:flex;">
      <div class="nsR" style="font-size:15px; width:85%; display:inline-block;">푸쉬 알림</div>
      <div style="width:15%; display:inline-block;">
        <label class="switch">
          <input type="checkbox" id="push_chk">
          <div class="slider round"></div> 
        </label>
      </div>
    </div>

    <div style="width:100%; padding-top:15px; display:flex;">
      <div class="nsR" style="font-size:15px; width:85%; display:inline-block;">E-MAIL 수신동의</div>
      <div style="width:15%; display:inline-block;">
        <label class="switch">
          <input type="checkbox" id="email_chk">
          <div class="slider round"></div> 
        </label>
      </div>
    </div>

    <div style="width:100%; padding-top:15px; display:flex;">
      <div class="nsR" style="font-size:15px; width:85%; display:inline-block;">SMS 수신동의</div>
      <div style="width:15%; display:inline-block;">
        <label class="switch">
          <input type="checkbox" id="sms_chk">
          <div class="slider round"></div> 
        </label>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="nsB" style="font-size:18px; color:#000;">버전 정보</div>
    <div class="nsR" style="font-size:15px; padding-top:15px;">2.0.0</div>
  </div>

<!-- <label class="switch">
  <input type="checkbox">
  <div class="slider round"></div> 
</label> -->

<!-- <label class="switch">
  <input type="checkbox" checked>
  <div class="slider round"></div>
</label> -->
<script src="//code.jquery.com/jquery-2.2.0.min.js" type="text/javascript"></script>
<script src="/js/sweetalert.min.js"></script>

<script type="text/javascript">
function setCookie(name, value, days) {
  var d = new Date;
  d.setTime(d.getTime() + 24*60*60*1000*days);
  document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
}

function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
$(document).on('ready', function() {
  // userCheck(getCookie('user'));
	var user = getCookie('user');
	if(user == null || user == "") {
		document.location.href="/login.html";
	}else {
		$("#CUST_ID").val(user);
	}
	// 디바이스 정보 검색
	var datas = $("#membership_frm").serialize();
	$.ajax({
		url : "/api/mbl_0610.jsp",
		type : 'POST',
		dataType : 'JSON',
		data : datas,
		success:function(response){
		// console.log(response);
			if(response.RET_CD == "0001") {
				$('#DEVICE_DIV').val(response.RESULT[0].DEVICE_DIV);
				$('#DEVICE_NM').val(response.RESULT[0].DEVICE_NM);
				$('#MOBILE_KIND').val(response.RESULT[0].MOBILE_KIND);
				$('#AUTH_TOKEN').val(response.RESULT[0].AUTH_TOKEN);
			}else {
				swal({
					button: "확인",
					title: "안내",
					closeOnClickOutside: false,
					// text: '오류코드: '+response.RET_CD+'\n'+response.RET_MSG
          text: response.RET_MSG
				});
			}
		}
	});
  
  
  

  var datas = $("#membership_frm").serialize();
  $.ajax({
      url : "/api/mbl_0500.jsp",
      type : 'POST',
      dataType : 'JSON',
      data : datas,
        success:function(response){
          console.log();
          // alert(response.RESULT[0].CUST_STAT)
          if(response.RESULT[0] !== undefined){
            if(response.RET_CD == "0001"){
              if(response.RESULT[0].CUST_STAT == "2"){
                var CUST_WEB_ID = response.RESULT[0].CUST_WEB_ID;
                $("#find").html(CUST_WEB_ID);
                if(response.RESULT[0].PUSH_RCV_YN == 'Y') {
                  $('input:checkbox[id="push_chk"]').attr("checked", true);
                  $("#PUSH_RCV_YN").val('Y');
                }else {
                  $('input:checkbox[id="push_chk"]').attr("checked", false);
                  $('#PUSH_RCV_YN').val('N');
                }
                if(response.RESULT[0].EMAIL_RCV_YN == 'Y') {
                  $('input:checkbox[id="email_chk"]').attr("checked", true);
                  $('#EMAIL_RCV_YN').val('Y');
                }else {
                  $('input:checkbox[id="email_chk"]').attr("checked", false);
                  $('#EMAIL_RCV_YN').val('N');
                }
                if(response.RESULT[0].SMS_RCV_YN == 'Y') {
                  $('input:checkbox[id="sms_chk"]').attr("checked", true);
                  $('#SMS_RCV_YN').val('Y');
                }else {
                  $('input:checkbox[id="sms_chk"]').attr("checked", false);
                  $('#SMS_RCV_YN').val('N');
                }
              }else{
                document.location.href="logout.html";
              }
            }else if(response.RET_CD == "0170"){
                document.location.href="logout.html";
            }
          }else{
            document.location.href="logout.html";
          }
        }
  });

  $('#logout').click(function(){
    var user = getCookie('user');
    swal({
        title: "로그아웃 안내",
        text: "로그아웃을 하시겠습니까?",
        buttons: ["취소", "로그아웃"],
        dangerMode: true,
        closeOnClickOutside: false
    })
    .then((willDelete) => {
      if (willDelete) {
	    $('#AUTH_TOKEN').val("");
	  	var datas = $("#membership_frm").serialize();
		$.ajax({
	      url : "/api/mbl_0600.jsp",
		  type : 'POST',
		  dataType : 'JSON',
		  data : datas,
			success:function(response){
// 				console.log(response);
				if(response.RET_CD == "0001") {
					swal("로그아웃에 성공하셨습니다.\n로그인 페이지로 이동합니다.", {
			          icon: "success",
			          closeOnClickOutside: false,
			          buttons: "확인"
			        }).then(function() {
			          setCookie('user', null, -1);
			          setCookie('web_id', null, -1);
			          window.location = "/login.html";
			        });
				}else {
					swal({
		                button: "확인",
		                title: "안내",
		                closeOnClickOutside: false,
		                // text: '오류코드: '+response.RET_CD+'\n'+response.RET_MSG
                    text: response.RET_MSG
		            });
				}
			}
		  });

      } else {
        location.reload();
      }
    });
  });

  $('#email_chk').click(function(){
    // alert($('#email_chk').is(":checked"));
    if($('#email_chk').is(":checked")) {
      $("#EMAIL_RCV_YN").val('Y');
    }else {
      $("#EMAIL_RCV_YN").val('N');
    }
    var datas = $("#membership_frm").serialize();
    $.ajax({
      url : "/api/mbl_0220.jsp",
      type : 'POST',
      dataType : 'JSON',
      data : datas,
      success:function(response){
        // console.log(response);
        if(response.RET_CD != "0001") {
          swal({
                    button: "확인",
                    title: "안내",
                    closeOnClickOutside: false,
                    // text: '오류코드: '+response.RET_CD+'\n'+response.RET_MSG
                    text: response.RET_MSG
                });
        }
      }
    });
  });
  $('#push_chk').click(function(){
    if($('#push_chk').is(":checked")) {
      $("#PUSH_RCV_YN").val('Y');
    }else {
      $("#PUSH_RCV_YN").val('N');
    }
    var datas = $("#membership_frm").serialize();
    $.ajax({
      url : "/api/mbl_0220.jsp",
      type : 'POST',
      dataType : 'JSON',
      data : datas,
      success:function(response){
        if(response.RET_CD != "0001") {
          swal({
                    button: "확인",
                    title: "안내",
                    closeOnClickOutside: false,
                    // text: '오류코드: '+response.RET_CD+'\n'+response.RET_MSG
                    text: response.RET_MSG
                });
        }  
      }
    });
  });
  $('#sms_chk').click(function(){
    if($('#sms_chk').is(":checked")) {
      $("#SMS_RCV_YN").val('Y');
    }else {
      $("#SMS_RCV_YN").val('N');
    }
    var datas = $("#membership_frm").serialize();
    $.ajax({
      url : "/api/mbl_0220.jsp",
      type : 'POST',
      dataType : 'JSON',
      data : datas,
      success:function(response){
        if(response.RET_CD != "0001") {
          swal({
                    button: "확인",
                    title: "안내",
                    closeOnClickOutside: false,
                    // text: '오류코드: '+response.RET_CD+'\n'+response.RET_MSG
                    text: response.RET_MSG
                });
        }
      }
    });
  });

  $('#back').click(function(){
    document.location.href="/mypage.html";
  });
});
</script>
</body>
</html>
