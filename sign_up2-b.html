<!DOCTYPE html>
<html>
	<head>
		<title>PlayTime</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="/css/style.css">
		<!-- fontawesome -->
		<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<!-- nanumsquare -->
		<link rel="stylesheet" type="text/css" href="//cdn.rawgit.com/innks/NanumSquareRound/master/nanumsquareround.min.css">
		<link rel="stylesheet" href="//cdn.rawgit.com/hiun/NanumSquare/master/nanumsquare.css">
		<!-- Bootstrap -->
		<link rel="stylesheet" type="text/css" href="/css/bootstrap.css">
		<style>
		body {
			margin: 0px;
			color: #000;
		}
		input {
			width: 100%;
			height: 45px;
			font-size: 13px;
			border-radius: 10px;
			border:1px solid #ddd;
		}
		select {
			width: 100%;
			height:45px;
			font-size: 13px;
			border-radius: 10px;
			border:1px solid #ddd;
			-webkit-appearance: none;
			background-color: white;
			background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAJCAYAAAA/33wPAAAAvklEQVQoFY2QMQqEMBBFv7ERa/EMXkGw11K8QbDXzuN4BHv7QO6ifUgj7v4UAdlVM8Uwf+b9YZJISnlqrfEUZVlinucnBGKaJgghbiHOyLyFKIoCbdvecpyReYvo/Ma2bajrGtbaC58kCdZ1RZ7nl/4/4d5EsO/7nzl7IUtodBexMMagaRrs+06JLMvcNWmaOv2W/C/TMAyD58dxROgSmvxFFMdxoOs6lliWBXEcuzokXRbRoJRyvqqqQvye+QDMDz1D6yuj9wAAAABJRU5ErkJggg==);
			background-position : right center;
			background-repeat: no-repeat;
			padding-right: 1.5em;
		}
		.content  {
			line-height: 30px;
			padding-top: 35px;
			height: 90px;
			text-align: center;
			color: #000;
		}
		.button {
			height: 100%;
			background-color: #808080;
			border-color: #fff;
			border-radius:10px;
			color: #fff;
			border: none;
		}
		.blank {
			height: 20px;
		}
		.footer {
			position:relative;
			bottom:0;
			height:90px;
			width: 100%;
			text-align: center;
			background-color: #FFCA02;
			border: none;
			color: #fff;
			font-size: 22px;
		}
		.active {
			background-color:#FFCA02 !important;
		}
		.check {
			color:#fff !important;
		}
		div.select_box {
			position: relative;
			height: 45px;
			border: 1px solid #E9DDDD;
			border-radius: 10px;
		}
		div.select_box label {
			position: absolute;
			color: #8e8e8e;
			top: 13px;
			left: 12px;
			letter-spacing: 1px;
		}
		div.select_box select.color {
			width: 100%;
			height: 40px;
			min-height: 40px;
			line-height: 40px;
			padding: 0 10px;
			opacity: 0;
		}
		.swal-modal {
			border-radius: 10px;
			margin: 0 10px;
			/* width: calc(100% - 100px) !important; */
		}
		.swal-title {
			background-color: #FFCA02;
			color: #FFF;
			margin: 0px !important;
			font-size: 18px;
			margin-bottom: 0px;
			padding-top: 15px;
			border-top-right-radius: 10px;
			border-top-left-radius: 10px;
		}
		.swal-text { 
			background-color: #FFF;
			padding-top: 17px;
			display: block;
			margin: 22px;
			text-align: center;
			color: #000;
			font-size: 15px;
		}
		.swal-footer {
			text-align: center;
			color: #FFF;
			background-color: #fff;
		}
		.swal-button:not([disabled]):hover {
			background-color: #FFCA02;
		}
		.swal-button:not([disabled]):hover {
			background-color: #FFCA02;
		}
		.swal-button:active {
			background-color: #FFCA02;
		}
		.swal-button {
			background-color: #FFCA02;
			color: #fff;
			border: none;
			box-shadow: none;
			border-radius: 5px;
			font-weight: 600;
			font-size: 14px;
			padding: 10px 24px;
			margin: 0;
			cursor: pointer;
			width: 100px;
			height: 40px;
		}
		.change-pw-info {
			line-height:140%;
			padding:20px 0;
		}
		.change-pw-info ul {
			list-style:none;
			margin-bottom:0;
		}
		.change-pw-info ul li {
			padding-bottom:5px;
			list-style:disc;
			line-height:140%;
			text-align:left;
			font-size:12px;
			color:#d35252;
		}
		</style>
	</head>
	<body>
		<div style="margin:0 8%;min-height:calc(100vh - 235px);">
			<!-- top space -->
			<div style="text-align:center; padding-top:25px;">
				<!-- logo -->
				<div style="text-align: center;">
					<img src="/images/logo.png" style="width:160px; text-align:center;">
				</div>
				<!-- font -->
				<div style="height:auto;">
					<div class="nsrB content" style="font-size:22px;">자녀정보등록</div>
				</div>
				
			    <div class="change-pw-info">
			      <ul>
					<li>자녀정보는 1명이상 필수로 등록해주세요(최대 5명까지 등록가능)</li>
			        <li>등록하신 자녀정보는 수정이 불가합니다.</li>
			        <li>수정이 필요하신 경우, 매장 직원에게 문의해주세요.</li>
			      </ul>
			    </div>
				
				<form method="post" id="childForm" action="/api/mbl_0210.jsp">
					<input type="hidden" name="COMP_CD" value="010">
					<input type="hidden" name="USER_ID" value="MOBILE">
					<input type="hidden" name="APPEND_CNT" value="4">
					<input type="hidden" name="CUST_ID">
					<!-- 가입브랜드 코드 -->
					<input type="hidden" name="BRAND_CD" value="101">
					<!-- 가입매장 코드 -->
					<input type="hidden" name="STOR_CD" value="1019999">
					
					<!--  defualt children input  -->
					<div id="def_chi">
						<div class="children_defaulte">
							<label style="text-align:left; width: 100%; margin:0px 3% 0 3%;">자녀 이름/성별</label>
							<div style="height:45px;">
								<!-- member name input box -->
								<div style="float:left; width:61%; height:100%;">
									<input class="nsR child_nm" style="color:#000; padding-left:10px;" type="text" name="C_CHILD_NM" placeholder="자녀의 이름을 입력해주세요.">
								</div>
								<!-- blank space -->
								<div style="float:left; width:3%; height:100%;">
								</div>
								<!-- gender select -->
								<div class="input-group" style="height:100%;">
									<div class="input-group-addon nsR ch_sex1" style="border-top-left-radius:10px; border-bottom-left-radius:10px; background-color:#fff; font-size:13px;" onclick="console.log(2)">남</div>
									<div class="input-group-addon nsR ch_sex2" style="border-top-right-radius:10px; border-bottom-right-radius:10px; background-color:#fff; font-size:13px;" onclick="console.log(2)">여</div>
									<input type='hidden' class='sex_div' name='C_SEX_DIV'>
									<input type='hidden' class='birth_dt' name='C_BIRTH_DT'>
									<input type='hidden' name='C_USE_YN' value='Y'>
									<input type='hidden' name='C_CHILD_NO' value='0'>
								</div>
							</div>
							<label style="text-align:left; width: 100%; margin:20px 3% 0 3%;">자녀 생년월일</label>
							<div style="height:45px; margin-bottom:20px;">
								<!-- member birthday input box -->
								<div style="float:left; width:40%; height:100%;">
									<input class="nsR year" style="text-align:center" type="number" name="" placeholder="ex) 2002" maxlength="4">
								</div>
								<!-- blank space -->
								<div style="float:left; width:3%; height:100%;">
								</div>
								<!-- member birthday input box -->
								<div style="float:left; width:27%; height:100%;">
									<input class="nsR month" style="text-align:center" type="number" name="" placeholder="ex) 01" maxlength="2">
								</div>
								<!-- blank space -->
								<div style="float:left; width:3%; height:100%;">
								</div>
								<!-- member birthday input box -->
								<div class="input-group" style="float:left; width:27%; height:100%;">
									<input class="nsR day" style="text-align:center" type="number" name="" placeholder="ex) 01" maxlength="2">
								</div>
							</div>
						</div>
					</div>
					<!-- children addition -->
					<div id="divid" style="margin: 20px 0;"><hr></hr></div>
					<div id="C_frm"></div>
				</div>
			</div>
			
			<!-- add children button -->
			
			<button id="add-btn" type="button" class="footer nsB" style="font-size:15px; background-color:#fff; color:#000; height:125px;">자녀분이 더 있으신가요?</button>
			<!-- next step button  -->
			<button id="next-btn" type="button" class="footer nsrEB">등록완료</button>
			
		</div>

		</form>
		
		<!-- iOS에서는 position:fixed 버그가 있음, 적용하는 사이트에 맞게 position:absolute 등을 이용하여 top,left값 조정 필요 -->
		<div id="layer" style="display:none; position:fixed; overflow:hidden; z-index:1; -webkit-overflow-scrolling:touch;">
			<img src="//t1.daumcdn.net/localimg/localimages/07/postcode/320/close.png" id="btnCloseLayer" style="cursor:pointer;position:absolute;right:-3px;top:-3px;z-index:1" onclick="closeDaumPostcode()" alt="닫기 버튼">
		</div>
	
		<script src="//code.jquery.com/jquery-2.2.0.min.js" type="text/javascript"></script>
		<script src="/js/sweetalert.min.js"></script>
		<script src="//ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>
		<script type="text/javascript" src="//jsgetip.appspot.com"></script>
		<script type="text/javascript">
			$(document).ready(function(){
				// 아이디 중복체크용 배열 생성
				var nmArr = [];
				
				// get url prameter
				var CUST_ID = getParameterByName('CUST_ID');
				$("input[name=CUST_ID]").val(CUST_ID);
				var cf = getParameterByName('Classification');
				
				// get cookie
				var BRAND_CD = getCookie('BRAND_CD');
				$("input[name=CUST_ID]").val(CUST_ID);
				var STOR_CD = getCookie('STOR_CD');
				$("input[name=CUST_ID]").val(CUST_ID);
				
				var datas = $("#childForm").serialize();
				// 아이 정보 검색
				$.ajax({
					url: "/api/mbl_0110.jsp",
					type: 'POST',
					dataType: 'JSON',
					data: datas,
					success: function (response) {
						if(response.RET_CD == "0001") {
							// 등록가능 아이수 정보
							var APPEND_CNT = response.APPEND_CNT;
							if(APPEND_CNT != 0 && APPEND_CNT == 5) {							
								$("input[name=APPEND_CNT]").val(APPEND_CNT - 1);	
							}else {
								$("input[name=APPEND_CNT]").val(APPEND_CNT);	
							}
							var result = "";
							if(response.RESULT.length > 0) {
								for(var i = 0; i < response.RESULT.length; i++) {
									nmArr.push(response.RESULT[i].CHILD_NM);
									result += "<div class='existe'>"
										+ "<label style='text-align:left; width: 100%; margin:0px 3% 0 3%;'>자녀 이름/성별</label>"
										+ "<div style='height:45px;'>"
										+ "<div style='float:left; width:61%; height:100%;'>"
										+ "<input class='nsR child_nm' style='color:#000; padding-left:10px; background-color:#f3f3f3;' type='text' placeholder='자녀의 이름을 입력해주세요.' value='"+response.RESULT[i].CHILD_NM+"' readonly>"
										+ "</div>"
										+ "<div style='float:left; width:3%; height:100%;'></div>"
										+ "<div class='input-group' style='height:100%;'>";
									if(response.RESULT[i].SEX_DIV == "M"){
										result += "<div class='input-group-addon nsR' style='border-top-left-radius:10px; border-bottom-left-radius:10px; background-color:#FFCA02; font-size:13px;'>남</div>"
										+ "<div class='input-group-addon nsR' style='border-top-right-radius:10px; border-bottom-right-radius:10px; background-color:#fff; font-size:13px;'>여</div>";
									}else {
										result += "<div class='input-group-addon nsR' style='border-top-left-radius:10px; border-bottom-left-radius:10px; background-color:#fff; font-size:13px;'>남</div>"
										+ "<div class='input-group-addon nsR' style='border-top-right-radius:10px; border-bottom-right-radius:10px; background-color:#FFCA02; font-size:13px;'>여</div>";
									}
									result += "<input type='hidden' class='sex_div' value='"+response.RESULT[i].SEX_DIV+"'>"
										+ "<input type='hidden' class='birth_dt' value='"+response.RESULT[i].BIRTH_DT+"'>"
										+ "<input type='hidden' value='Y'>"
										+ "<input type='hidden' value='"+response.RESULT[i].CHILD_NO+"'>"
										+ "</div>"
										+ "</div>"
										+ "<label style='text-align:left; width: 100%; margin:20px 3% 0 3%;'>자녀 생년월일</label>"
										+ "<div style='height:45px; margin-bottom:20px;'>"
										+ "<div style='float:left; width:40%; height:100%;'>";									
									if (response.RESULT[i].BIRTH_DT != null && response.RESULT[i].BIRTH_DT != '') {
										result += "<input class='nsR year' style='text-align:center; background-color:#f3f3f3;' type='number' placeholder='ex) 2002' maxlength='4' value='"+response.RESULT[i].BIRTH_DT.substring(0,4)+"' readonly>"
											+ "</div>"
											+ "<div style='float:left; width:3%; height:100%;'></div>"
											+ "<div style='float:left; width:27%; height:100%;'>"
											+ "<input class='nsR month' style='text-align:center; background-color:#f3f3f3;' type='number' placeholder='ex) 01' maxlength='2' value='"+response.RESULT[i].BIRTH_DT.substring(4,6)+"' readonly>"
											+ "</div>"
											+ "<div style='float:left; width:3%; height:100%;'></div>"
											+ "<div class='input-group' style='float:left; width:27%; height:100%;'>"
											+ "<input class=;'nsR day' style='text-align:center; background-color:#f3f3f3;' type='number' placeholder='ex) 01' maxlength='2' value='"+response.RESULT[i].BIRTH_DT.substring(6,8)+"' readonly>"
											+ "</div>"
											+ "</div>"
											+ "</div>";
									}else {
										result += "<input class='nsR year' style='text-align:center' type='number' placeholder='ex) 2002' maxlength='4'>"
											+ "</div>"
											+ "<div style='float:left; width:3%; height:100%;'></div>"
											+ "<div style='float:left; width:27%; height:100%;'>"
											+ "<input class='nsR month' style='text-align:center' type='number' placeholder='ex) 01' maxlength='2'>"
											+ "</div>"
											+ "<div style='float:left; width:3%; height:100%;'></div>"
											+ "<div class='input-group' style='float:left; width:27%; height:100%;'>"
											+ "<input class=;'nsR day' style='text-align:center' type='number' placeholder='ex) 01' maxlength='2'>"
											+ "</div>"
											+ "</div>"
											+ "</div>";
									}	
								}
								$("#divid").hide();
					            $("#C_frm").append(result);
								$("#def_chi").empty();		
							}
						}
					}
				});
				
				// 자녀 성별 클릭 이벤트
				$(document).on("click",".ch_sex1",function(){ 
					var m_sex = $(this).parent().find($(".ch_sex1"));
					var f_sex = $(this).parent().find($(".ch_sex2"));
					var v_sex = $(this).parent().find($("input[name=C_SEX_DIV]"));
					m_sex.css('background-color','#FFCA02');
					f_sex.css('background-color','#FFF');
					v_sex.val("M");
				});
				$(document).on("click",".ch_sex2",function(){ 
					var m_sex = $(this).parent().find($(".ch_sex1"));
					var f_sex = $(this).parent().find($(".ch_sex2"));
					var v_sex = $(this).parent().find($("input[name=C_SEX_DIV]"));
					f_sex.css('background-color','#FFCA02');
					m_sex.css('background-color','#FFF');
					v_sex.val("F");
				});
				
				// 자녀 생년월일 변경 이벤트
				$(document).on("change",".year",function(){ 
					var pattern1 = /^\d{4}$/;
					var year = $(this).val();
					if(!pattern1.test(year)) {
						swal({
							button: "확인",
							title: "안내",
							text: "4자리수 숫자만 입력가능합니다.",
							closeOnClickOutside: false
						});
						$(this).val("");
						$(this).focus();
					}
				});
				$(document).on("change",".month",function(){ 
					var pattern1 = /^\d{2}$/;
					var month = $(this).val();
					if(!pattern1.test(month)) {
						swal({
							button: "확인",
							title: "안내",
							text: "2자리수 숫자만 입력가능합니다.\n10보다 작을경우 앞에 0을 붙여주세요.",
							closeOnClickOutside: false
						});
						$(this).val("");
						$(this).focus();
					}
				});
				$(document).on("change",".day",function(){ 
					var pattern1 = /^\d{2}$/;
					var day = $(this).val();
					if(!pattern1.test(day)) {
						swal({
							button: "확인",
							title: "안내",
							text: "2자리수 숫자만 입력가능합니다.\n10보다 작을경우 앞에 0을 붙여주세요.",
							closeOnClickOutside: false
						});
						$(this).val("");
						$(this).focus();
					}
				});
				
				
				
				
				// 자녀 추가버튼 이벤트
				$("#add-btn").click(function(){
					// 자녀 등록가능 수
					var ac = $('input[name=APPEND_CNT]').val();
					if(ac != 0) {
						var result = "";
						result += "<div class='children'>"
							+"<div style='padding-top:20px; text-align:right; font-size:25px;'></div>"
							+ "<label style='text-align:left; width: 100%; margin:0px 3% 0 3%;'>자녀이름/성별</label>"
							+"<div style='height:45px;'>"
							+"<div style='float:left; width:61%; height:100%;'>"
							+"<input class='nsR child_nm' style='color:#000; padding-left:10px;' type='text' name='C_CHILD_NM' placeholder='자녀의 이름을 입력해주세요.'>"
							+"</div>"
							+"<div style='float:left; width:3%; height:100%;'></div>"
							+"<div class='input-group' style='height:100%;'>"
							+"<div class='input-group-addon nsR ch_sex1' style='border-top-left-radius:10px; border-bottom-left-radius:10px; background-color:#fff; font-size:13px;' onclick='console.log(2)'>남</div>"
							+"<div class='input-group-addon nsR ch_sex2' style='border-top-right-radius:10px; border-bottom-right-radius:10px; background-color:#fff; font-size:13px;' onclick='console.log(2)'>여</div>"
							+"<input type='hidden' class='sex_div' name='C_SEX_DIV'>"
							+"<input type='hidden' class='birth_dt' name='C_BIRTH_DT'>"
							+"<input type='hidden' name='C_USE_YN' value='Y'>"
							+"<input type='hidden' name='C_CHILD_NO' value='0'>"
							+"</div>"
							+"</div>"
							+"<label style='text-align:left; width: 100%; margin:20px 3% 0 3%;'>자녀 생년월일</label>"
							+"<div style='height:45px; margin-bottom: 20px;'>"
							+"<div style='float:left; width:40%; height:100%;'>"
							+"<input class='nsR year' style='text-align:center' type='number' name='childrenBirthYear' placeholder='ex) 2002' maxlength='4'>"
							+"</div>"
							+"<div style='float:left; width:3%; height:100%;'></div>"
							+"<div style='float:left; width:27%; height:100%;'>"
							+"<input class='nsR month' style='text-align:center' type='number' name='childrenBirthMonth' placeholder='ex) 01' maxlength='2'>"
							+"</div>"
							+"<div style='float:left; width:3%; height:100%;'></div>"
							+"<div class='input-group' style='float:left; width:27%; height:100%;'>"
							+"<input class='nsR day' style='text-align:center' type='number' name='childrenBirthDay' placeholder='ex) 01' maxlength='2'>"
							+"<div class='blank'></div>"
							+"</div>"
							+"</div>"
							+"</div>";
						$("#C_frm").append(result);
						ac = ac - 1;
						$('input[name=APPEND_CNT]').val(ac);
					}else {
				        swal({
					    	button: "확인",
					        title: "안내",
					        text: "등록가능한 자녀수를 초과하였습니다.",
					        closeOnClickOutside: false
				    	});
				    	return false
					}
				});
				
				// 아이등록 버튼클릭
				$("#next-btn").click(function(){
					var able = true;
					// 기본 아이등록 설정 
					var childrenYn = true;
					var childrenDate = true;
					var childrenName = true;
					var blankChk = false;
					// 자녀 이름 배열 선언
					var nmArr2 = [];
					for(var i = 0; i < nmArr.length; i++) {
						nmArr2.push(nmArr[i]) ;
					}
					// 입력된 아이 이름수
					var existeSize = $(".existe").length;
					var size = $(".children_defaulte").length + $(".children").length;

					// 오늘날짜
					var date = new Date(); 
					var toYear = date.getFullYear(); 
					var toMonth = new String(date.getMonth()+1); 
					var toDay = new String(date.getDate());
					if(toMonth < 10){
						toMonth = "0"+toMonth;
					}
					if(toDay < 10){
						toDay = "0"+toDay;
					}
					// 기존 등록된 자녀 체크
					if(existeSize > 0) {
						// 신규등록할 자녀가 존재하는지 체크
						if(size > 0) {
							// 자녀 이름 배열 선언
							var nmArr2 = [];
							for(var i = 0; i < nmArr.length; i++) {
								nmArr2.push(nmArr[i]) ;
							}
							// 정상 등록 로직
							$(".children").each(function(){
								// 입력받은 날짜
								var child_nm = $(this).find(".child_nm").val();
								var sex_div = $(this).find(".sex_div").val();
								var year = $(this).find(".year").val();
								var month = $(this).find(".month").val();
								var day = $(this).find(".day").val();
								$(this).find(".birth_dt").val(String(year)+String(month)+String(day));
								if(child_nm == ""  && year == "" && month == "" && day == ""){
									
								}else if(child_nm != "" && year != "" && month != "" && day != "") {
									blankChk = false;
								}else {
									childrenYn = false;
								}
																
								// 날짜 체크
								var addDay1 = year+month+day;
								var addDay2 = toYear+toMonth+toDay;
								
								if(parseInt(addDay2) - parseInt(addDay1) < 0 ) {						
									childrenDate = false;
								}
								// 자녀 이름 중복체크
								if(nmArr2.indexOf(child_nm) == -1) {
									nmArr2.push(child_nm);										
								}else {
									childrenName = false;
								}

							});

							if(blankChk) {
								if(cf == 'edit') {
									swal({
										button: "확인",
										title: "안내",
										text: "회원수정이 완료되었습니다."
// 										closeOnClickOutside: false
									}).then(function() {
										document.location.href="/mypage.html";																							
									});										
								}else {
									swal({
										button: "확인",
										title: "안내",
										text: "회원가입이 완료되었습니다."
// 										closeOnClickOutside: false
									}).then(function() {
										document.location.href="/sign_up3.html";	
									});
								}
							}else {					
								// validation
								if(!childrenYn){
									swal({
										button: "확인",
										title: "안내",
										text: "아이 정보중 이름, 성별, 생년월일은 필수값입니다."
// 										closeOnClickOutside: false
									});
									return false;									
								}
								if(!childrenDate) {
									swal({
										button: "확인",
										title: "안내",
										text: "자녀의 생년월일을\n오늘날짜 이전으로 입력해주세요."
// 										closeOnClickOutside: false
									});
									return false;
								}
								if(!childrenName) {
									swal({
										button: "확인",
										title: "안내",
										text: "아이 정보중 이름이 중복입니다."
// 										closeOnClickOutside: false
									});
									return false;	
								}

								// 아이등록 api 호출
								if(able == true) {
									able = false;
									var datas = $("#childForm").serialize();
									console.log(datas);
									$.ajax({
										url : "/api/mbl_0210.jsp",
										type : 'POST',
										dataType : 'JSON',
										data : datas,
										success:function(response){
											console.log(response);
											if(response.RET_CD == "0001") {
												if(cf == 'edit') {
													swal({
														button: "확인",
														title: "안내",
														text: "회원수정이 완료되었습니다."
// 														closeOnClickOutside: false
													}).then(function() {
														document.location.href="/mypage.html";																							
													});
												}else {
													swal({
														button: "확인",
														title: "안내",
														text: "회원가입이 완료되었습니다."
// 														closeOnClickOutside: false
													}).then(function() {
														document.location.href="/sign_up3.html";	
													});
												}
											}else {
												able = true;
												swal({
													button: "확인",
													title: "안내",
													text: response.RET_MSG
// 													closeOnClickOutside: false
												});
												return false;
											}
										}
									});
								}else {
									swal({
										button: "확인",
										title: "안내",
										text: '이미 처리중입니다.\n잠시후 다시 시도해주세요.'
// 										closeOnClickOutside: false
									});
									return false
								}
							}
						}else {
							if(cf == 'edit') {
								swal({
									button: "확인",
									title: "안내",
									text: "회원수정이 완료되었습니다."
// 									closeOnClickOutside: false
								}).then(function() {
									document.location.href="/mypage.html";																							
								});								
							}else {
								swal({
									button: "확인",
									title: "안내",
									text: "회원가입이 완료되었습니다."
// 									closeOnClickOutside: false
								}).then(function() {
									document.location.href="/sign_up3.html";	
								});
							}
						}
					}else {
						// 신규등록할 자녀가 존재하는지 체크
						if(size > 0) {
							// 자녀 이름 배열 선언
							var nmArr2 = [];
							var de_childrenYn = true;
							var de_childrenDate = true;
							var de_childrenName = true;
							for(var i = 0; i < nmArr.length; i++) {
								nmArr2.push(nmArr[i]) ;
							}
							// 정상 등록 로직
							var	de_child_nm = "";
							$(".children_defaulte").each(function(){
								de_child_nm = $(this).find(".child_nm").val();
								var de_sex_div = $(this).find(".sex_div").val();
								var de_year = $(this).find(".year").val();
								var de_month = $(this).find(".month").val();
								var de_day = $(this).find(".day").val();
								$(this).find(".birth_dt").val(String(de_year)+String(de_month)+String(de_day));
								
								if(de_child_nm == ""){
									de_childrenYn = false;
								}else if(de_sex_div == "") {
									de_childrenYn = false;
								}else if(de_year == "") {
									de_childrenYn = false;
								}else if(de_month == "") {
									de_childrenYn = false;
								}else if(de_day == ""){
									de_childrenYn = false;
								}
								
								//날짜 체크
								var addDay1 = de_year+de_month+de_day;
								var addDay2 = toYear+toMonth+toDay;
								if(parseInt(addDay2) - parseInt(addDay1) < 0 ) {						
									de_childrenDate = false;
								}
								
								//이름 중복체크
								if(nmArr2.indexOf(de_child_nm) == -1) {
									nmArr2.push(de_child_nm);										
								}else {
									de_childrenName = false;
								}		
								
							});
							// 빈칸 체크
							if(!de_childrenYn) {
								swal({
									button: "확인",
									title: "안내",
									text: "아이 정보중 이름, 성별, 생년월일은 필수값입니다."
// 									closeOnClickOutside: false
								});
								return false;
							}	
							// 날짜 체크
							if(!de_childrenDate) {
								swal({
									button: "확인",
									title: "안내",
									text: "자녀의 생년월일을\n오늘날짜 이전으로 입력해주세요."
// 									closeOnClickOutside: false
								});
								return false;
							}
							// 이름중복체크
							if(!de_childrenName) {
								swal({
									button: "확인",
									title: "안내",
									text: "아이 정보중 이름 중복이 존재합니다."
// 									closeOnClickOutside: false
								});
								return false;
							}
							
							$(".children").each(function(){
								// 입력받은 날짜
								var child_nm = $(this).find(".child_nm").val();
								var sex_div = $(this).find(".sex_div").val();
								var year = $(this).find(".year").val();
								var month = $(this).find(".month").val();
								var day = $(this).find(".day").val();
								$(this).find(".birth_dt").val(String(year)+String(month)+String(day));
								
								if(child_nm == "" && year == "" && month == "" && day == ""){
									childrenYn = true;
									blankChk == true;
								}else if(child_nm != "" && year != "" && month != "" && day != "") {
									childrenYn = true;
									blankChk == false;
								}								
								
								// 날짜 체크
								var addDay1 = year+month+day;
								var addDay2 = toYear+toMonth+toDay;
								if(parseInt(addDay2) - parseInt(addDay1) < 0 ) {
									childrenDate = false;					
								}
								
								// 이름 중복 체크
								if(nmArr2.indexOf(child_nm) == -1) {
									nmArr2.push(child_nm);										
								}else {
									childrenName = false;
								}	
							});		
							
							if(blankChk) {
								if(cf == 'edit') {
									swal({
										button: "확인",
										title: "안내",
										text: "회원수정이 완료되었습니다."
// 										closeOnClickOutside: false
									}).then(function() {
										document.location.href="/mypage.html";																							
									});									
								}else {
									swal({
										button: "확인",
										title: "안내",
										text: "회원가입이 완료되었습니다."
// 										closeOnClickOutside: false
									}).then(function() {
										document.location.href="/sign_up3.html";	
									});	
								}
								
							}else {
								// 입력칸 validation
								if(!childrenYn){
									swal({
										button: "확인",
										title: "안내",
										text: "아이 정보중 이름, 성별, 생년월일은 필수값입니다."
// 										closeOnClickOutside: false
									});
									return false
								}
								
								// 날짜 validation
								if(!childrenYn){
									swal({
										button: "확인",
										title: "안내",
										text: "자녀의 생년월일을\n오늘날짜 이전으로 입력해주세요."
// 										closeOnClickOutside: false
									});
									return false;
								}
								
								// 이름중복 validation
								if(!childrenName){
									swal({
										button: "확인",
										title: "안내",
										text: "아이 정보중 이름 중복이 존재합니다."
// 										closeOnClickOutside: false
									});
									return false
								}

								// 아이등록 api 호출
								if(able == true) {
									able = false;
									var datas = $("#childForm").serialize();
									console.log(datas);
									$.ajax({
										url : "/api/mbl_0210.jsp",
										type : 'POST',
										dataType : 'JSON',
										data : datas,
										success:function(response){
											if(response.RET_CD == "0001") {
												if(cf == 'edit') {
													swal({
														button: "확인",
														title: "안내",
														text: "회원수정이 완료되었습니다."
// 														closeOnClickOutside: false
													}).then(function() {
														document.location.href="/mypage.html";																							
													});								
												}else {
													swal({
														button: "확인",
														title: "안내",
														text: "회원가입이 완료되었습니다."
// 														closeOnClickOutside: false
													}).then(function() {
														document.location.href="/sign_up3.html";	
													});	
												}
											}else {
												able= true;
												swal({
													button: "확인",
													title: "안내",
													text: response.RET_MSG
// 													closeOnClickOutside: false
												});
												return false;
											}
										}
									});
								}else {
									able = true;
									swal({
										button: "확인",
										title: "안내",
										text: '이미 처리중입니다.\n잠시후 다시 시도해주세요.'
// 										closeOnClickOutside: false
									});
									return false
								}
							}	
						}
					}

				});
			});
			function getParameterByName(name) {
			  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			  var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
			    results = regex.exec(location.search);
			  return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			}
			function setCookie(name, value, days) {
			  var d = new Date;
			  d.setTime(d.getTime() + 24*60*60*1000*days);
			  document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
			}
			function getCookie(name) {
			  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
			  return v ? v[2] : null;
			}
			function numberWithCommas(x) {
			  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			}
			function uniqArr(arr) {
		        var chk = [];
		        for (var i = 0; i < arr.length; i++) {
		            if (chk.length == 0) {
		                chk.push(arr[i]);
		            } else {
		                var flg = true;
		                for (var j = 0; j < chk.length; j++) {
		                    if (chk[j] == arr[i]) {
		                        flg = false;
		                        break;
		                    }
		                }
		                if (flg) {
		                    chk.push(arr[i]);
		                }
		            }
		        }
		        return chk;
		    }
		</script>
	</body>
</html>